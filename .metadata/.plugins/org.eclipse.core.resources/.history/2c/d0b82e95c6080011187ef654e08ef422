package DataSetup;



import org.apache.poi.ss.usermodel.DataFormatter;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;

import java.io.FileInputStream;
import java.io.IOException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * A final utility class for reading data from Excel files (.xlsx format).
 * This class cannot be instantiated.
 */
public final class Reader2 {

    /**
     * Private constructor to prevent instantiation of this utility class.
     */
    private Reader2() {}

    /**
     * Reads an entire sheet from an Excel workbook and returns the data as a List of Maps.
     * Each map in the list represents a single row, where the key is the column header
     * and the value is the cell's content.
     *
     * @param filePath The path to the Excel file (e.g., "src/test/resources/TestData/data.xlsx").
     * @param sheetName The name of the sheet to be read from the workbook.
     * @return A List of Maps, where each map represents a row of data.
     * @throws IOException if the file cannot be found or read.
     */
    public static List<Map<String, String>> readData(String filePath, String sheetName) throws IOException {
        
        List<Map<String, String>> data = new ArrayList<>();

        try (FileInputStream fis = new FileInputStream(filePath);
             Workbook workbook = new XSSFWorkbook(fis)) {

            Sheet sheet = workbook.getSheet(sheetName);
//            if (sheet == null) {
//                throw new IOException("Sheet '" + sheetName + "' not found in the Excel file.");
//            }

            // Use a DataFormatter to handle all cell types (String, Numeric, Boolean, etc.) as Strings.
            DataFormatter dataFormatter = new DataFormatter();

            // 1. Read the header row to get the keys for our maps.
            List<String> headers = new ArrayList<>();
            sheet.getRow(0).forEach(cell -> headers.add(dataFormatter.formatCellValue(cell).trim()));

            // 2. Read the data rows (starting from the second row, index 1).
            for (int i = 1; i <= sheet.getLastRowNum(); i++) {
                Map<String, String> rowMap = new HashMap<>();
                // 3. Loop through all the columns defined by the header.
                for (int j = 0; j < headers.size(); j++) {
                    String header = headers.get(j);
                    // Handle cases where a row might be shorter than the header row.
                    String cellValue = (sheet.getRow(i).getCell(j) == null) 
                                       ? "" 
                                       : dataFormatter.formatCellValue(sheet.getRow(i).getCell(j)).trim();
                    rowMap.put(header, cellValue);
                }
              //  data.add(rowMap);
            }
        }
        return data;
    }
}
